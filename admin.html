<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Admin RAUN-Rachid2025</title>
  <link rel="stylesheet" href="style.css">
  <script type="module" src="firebase-config.js"></script>
  <script type="module" src="admin.js"></script>
  <style>
    body { background: black; color: lime; font-family: monospace; }
    .login-box { margin: 60px auto; max-width: 350px; border: 2px solid #33ff33; padding: 25px 25px 15px; border-radius: 16px; }
    input, button { background: black; color: lime; border: 1px solid #33ff33; font-family: monospace; font-size: 1.1rem; padding: 7px; border-radius: 8px; }
    .capsule-admin { border: 1px solid #33ff33; margin: 18px 0; padding: 12px; border-radius: 10px; }
    .danger { color: #ff3333; font-weight: bold; }
  </style>
</head>
<body>
  <a href="index.html" style="color:#00ffff;">← Retour à la page publique</a>
  <div class="login-box" id="loginBox">
    <h2>Connexion Admin <span style="font-size:1.5em;">🔐</span></h2>
    <input type="email" id="adminEmail" placeholder="Email" required><br><br>
    <input type="password" id="adminPassword" placeholder="Mot de passe" required><br><br>
    <button onclick="loginAdmin()">Se connecter</button>
    <div id="loginError" class="danger"></div>
  </div>

  <div id="adminPanel" style="display:none;">
    <h2>Capsules (Gestion Admin)</h2>
    <div id="capsulesList"></div>
    <button onclick="logoutAdmin()">Déconnexion</button>
  </div>
  
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getFirestore, collection, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
    import { firebaseConfig } from "./firebase-config.js";

    // Auth minimal (mot de passe unique "raun2025" par exemple)
    const ADMIN_EMAIL = "admin@raun.com";
    const ADMIN_PASS = "raun2025";

    // Admin "connexion"
    window.loginAdmin = function() {
      const email = document.getElementById('adminEmail').value.trim();
      const pass = document.getElementById('adminPassword').value.trim();
      if (email === ADMIN_EMAIL && pass === ADMIN_PASS) {
        document.getElementById('loginBox').style.display = 'none';
        document.getElementById('adminPanel').style.display = '';
        loadCapsulesAdmin();
      } else {
        document.getElementById('loginError').innerText = "Identifiants invalides !";
      }
    };

    window.logoutAdmin = function() {
      document.getElementById('adminPanel').style.display = 'none';
      document.getElementById('loginBox').style.display = '';
    };

    // Admin: affichage et suppression des capsules
    async function loadCapsulesAdmin() {
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const capsulesList = document.getElementById("capsulesList");
      capsulesList.innerHTML = "Chargement…";
      const querySnapshot = await getDocs(collection(db, "capsules"));
      let html = "";
      querySnapshot.forEach(docSnap => {
        const d = docSnap.data();
        html += `
          <div class="capsule-admin">
            <b>${d.titre || '(Sans titre)'}</b><br>
            <small>${d.contenu || ''}</small><br>
            Votes: ${d.votes_up || 0} 👍 / ${d.votes_down || 0} 👎 — Lectures: ${d.lectures || 0}<br>
            <button onclick="deleteCapsule('${docSnap.id}')">🗑️ Supprimer</button>
          </div>
        `;
      });
      capsulesList.innerHTML = html || "<i>Aucune capsule.</i>";
    }

    // Suppression
    window.deleteCapsule = async function(id) {
      if (confirm("Supprimer définitivement cette capsule ?")) {
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        await deleteDoc(doc(db, "capsules", id));
        loadCapsulesAdmin();
      }
    };
  </script>
</body>
</html>
